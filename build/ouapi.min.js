"use strict";!function(){function e(){f>=p?0==l&&(l=!0,$.when.apply($,c).always(function(){setTimeout(function(){o(),t(u)},g)})):t()}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e=e<=v.length?e:v.length;for(var t=0;t<e;t++){var r=v.shift();r.func.apply(y,r.args)}}function r(t){var r=t.complete||null,i=t.success||null,a=t.error||null,o={params:t.data};return t.success=function(r,s,d){n(),m.requestsPending--,e(),r.methodData=o,r.error?(m.requestsFailed++,t.deferred.reject(r),a&&a(r,s,d),$(y).trigger("ouapi.error",r)):(m.requestsSuccessful++,t.deferred.resolve(r),i&&i(r,s,d),$(y).trigger("ouapi.success",r))},t.error=function(r,i,s){n(),m.requestsPending--,m.requestsFailed++,e(),r.methodData=o,t.deferred.reject(r),a&&a(r,i,s),$(y).trigger("ouapi.error",r)},t.complete=function(e,t,i){e.methodData=o,r&&r(e,t,i),$(y).trigger("ouapi.complete",e)},m.requestsPending++,$.ajax(t)}function i(){return h<u}function a(){h++,f++}function n(){h--,m.requestsFinished++,v.length<1&&$(y).trigger("ouapi.empty")}function o(){f=0,c=[],l=!1}function s(e){return void 0!==e&&!(!e.promise||!e.notify)}function d(e,t,r){var n=r[r.length-1];return i()?(c.push(n.promise()),a(),!0):(v.push({func:y[e][t],args:r}),!1)}var u=3,g=2e3,p=5,c=[],l=!1,f=0,h=0,v=[],m={requestsQueued:0,requestsFinished:0,requestsMade:0,requestsSuccessful:0,requestsFailed:0,requestsPending:0},k=!1,y={snippets:{add:function(e,t,i,a,n,o){return r({type:"POST",url:gadget.get("apihost")+"/snippets/addsnippet",data:{authorization_token:gadget.get("token"),name:e,snippet:e,path:t,site:i,description:a,category:n},deferred:o}),o.promise()},createCategory:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/snippets/addcategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:i}),i.promise()},edit:function(e,t,i,a,n,o,s,d,u,g){var p=gadget.get("apihost")+"/snippets/editsnippet",c={authorization_token:gadget.get("token"),snippet:e,path:t,site:i,description:a,category:n,selected:!1};return c.name=void 0!==o&&o!=e?o:e,void 0!==s&&s!=t&&(c.path=s),void 0!==d&&d!=a&&(c.description=d),void 0!==u&&u!=n&&(c.category=u,c.old_category=n),r({type:"POST",url:p,data:c,deferred:g}),g.promise()},list:function(e,t){return r({type:"GET",url:gadget.get("apihost")+"/snippets/list",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},remove:function(e,t,i,a){return r({type:"POST",url:gadget.get("apihost")+"/snippets/removesnippet",data:{authorization_token:gadget.get("token"),snippet:e,site:t,category:i},deferred:a}),a.promise()},removeCategory:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/snippets/removecategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:i}),i.promise()}},files:{checkedOut:function(e,t){return r({type:"GET",url:gadget.get("apihost")+"/files/checkedout",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},checkin:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/files/checkin",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},checkout:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/files/checkout",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},create:function(e,t,i,a,n){void 0===a&&(a=!1);return r({type:"POST",url:gadget.get("apihost")+"/templates/new",data:{authorization_token:gadget.get("token"),site:i,path:t,template:"20_newfile.tcf",submit:"Create",tcf_value_0:e,tcf_value_1:a,tcf_value_2:"*inherit*"},deferred:n}),n.promise()},delete:function(e,t,i,a){void 0===i&&(i=!1);var n=gadget.get("apihost")+"/files/delete",o={authorization_token:gadget.get("token"),site:t,path:e,remote:i};return r({type:"POST",url:n,data:$.param(o,!0),deferred:a}),a.promise()},dependents:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},get:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},info:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/files/info",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},list:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()},new_folder:function(e,t,i,a){return r({type:"POST",url:gadget.get("apihost")+"/files/new_folder",data:{authorization_token:gadget.get("token"),name:e,site:i,path:t},deferred:a}),a.promise()},publish:function(e,t,i,a){return r({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:t,path:e,log:i},deferred:a}),a.promise()},publishMulti:function(e,t,i,a,n,o,s,d,u,g){void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===d&&(d=!1),void 0===u&&(u=!0);var p=gadget.get("apihost")+"/files/multipublish",c={authorization_token:gadget.get("token"),site:t,path:e,log:i,type:0,include_checked_out:a,include_scheduled_publish:n,include_pending_approval:o,changed_only:s,last_published:d,include_unpublished:u};return r({type:"POST",url:p,data:$.param(c,!0),deferred:g}),g.promise()},recycle:function(e,t,i){var a=gadget.get("apihost")+"/files/recycle",n={authorization_token:gadget.get("token"),site:t,path:e};return r({type:"POST",url:a,data:$.param(n,!0),deferred:i}),i.promise()},save:function(e,t,i,a){return r({type:"POST",url:gadget.get("apihost")+"/files/save",data:{authorization_token:gadget.get("token"),site:t,path:e,text:i},deferred:a}),a.promise()},source:function(e,t,i,a){void 0===i&&(i=!0);return r({type:"GET",url:gadget.get("apihost")+"/files/source",data:{authorization_token:gadget.get("token"),site:t,path:e,brokentags:i},deferred:a}),a.promise()}},directories:{settings:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/directories/settings",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:i}),i.promise()}},sites:{find:function(e,t,i,a,o,s,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=!0),void 0===s&&(s="string"),void 0===d&&(d=!0),void 0===u&&(u=[]);var p=gadget.get("apihost")+"/sites/findreplace",c={authorization_token:gadget.get("token"),site:e,srchstr:t,casesensitive:i,includelocked:a,paths:JSON.stringify(o),srchtype:s,negexts:d,extensions:u},l=new $.Deferred;return void 0===o?(n(),y.files.list("/",e).then(function(t){var i=$.map(t.entries,function(e){return e.staging_path});c.paths=JSON.stringify(i),r({type:"POST",url:p,data:$.param(c,!0),deferred:l}).then(function(t){return y.util.findReplaceStatus(e,t.id)}).then(function(e){g.resolve(e)}).fail(function(e){g.reject(e)})})):r({type:"POST",url:p,data:$.param(c,!0),deferred:l}).then(function(t){return y.util.findReplaceStatus(e,t.id)}).then(function(e){g.resolve(e)}).fail(function(e){g.reject(e)}),g.promise()},list:function(e,t,i,a){void 0===i&&(i=5e3),void 0===e&&(e=gadget.get("site")),void 0===t&&(t=gadget.get("account"));return r({type:"GET",url:gadget.get("apihost")+"/sites/list",data:{authorization_token:gadget.get("token"),count:i,account:t,site:e},deferred:a}),a.promise()},test:function(e,t){return y.sites.list(e).done(function(i){r({type:"GET",url:gadget.get("apihost")+"/snippets/list",data:{authorization_token:gadget.get("token"),site:e},deferred:t})}),t.promise()}},assets:{add_image:function(e,t,i,a,n,o){void 0===a&&(a=100),void 0===n&&(n=100);var s=new FormData,d=new File([fileContents],filename,{type:"image/jpeg"});return s.append(filename,d),r({type:"POST",url:gadget.get("apihost")+"/assets/add_image",data:{authorization_token:gadget.get("token"),site:e,asset:t,image:i,thumb_width:a,thumb_height:n},deferred:o}),o.promise()},checkin:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/assets/checkin",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:i}),i.promise()},checkout:function(e,t,i){return r({type:"POST",url:gadget.get("apihost")+"/assets/checkout",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:i}),i.promise()},delete:function(e,t,i){var a=gadget.get("apihost")+"/assets/delete",n={authorization_token:gadget.get("token"),site:e,asset:t};return r({type:"POST",url:a,data:$.param(n,!0),deferred:i}),i.promise()},dependents:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:"/OMNI-ASSETS/"+e+".html"},deferred:i}),i.promise()},info:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/assets/info",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:i}),i.promise()},list:function(e,t,i,a,n,o){void 0===t&&(t=100),void 0===i&&(i=1),void 0===a&&(a="name"),void 0===n&&(n="asc");return r({type:"GET",url:gadget.get("apihost")+"/assets/list",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS",count:t,start:i,sort_key:a,sort_order:n,ignore_readers:!0},deferred:o}),o.promise()},new:function(){},newForm:function(e,t,i,a,n,o,s,d,u,g,p){void 0!==a&&""!=a||(a="[]"),void 0!==n&&""!=n||(n="[]"),void 0===o&&(o="Everyone"),void 0===s&&(s="Everyone"),void 0===u&&(u=!0),void 0===g&&(g={pass_message:"Thank you for your submission",fail_message:"There was an error. Please try again.",use_database:!0,captcha:!1});var c=gadget.get("apihost")+"/assets/new",l={authorization_token:gadget.get("token"),name:e,site:t,description:i,group:o,readers:s,elements:a,emails:n,tags:d,site_locked:u,type:4};return $.extend(l,g),r({type:"POST",url:c,data:$.param(l,!0),deferred:p}),p.promise()},newImageGallery:function(e,t,i,a,n,o,s,d,u){void 0===a&&(a="Everyone"),void 0===n&&(n="Everyone"),void 0===s&&(s=!0),void 0===d&&(d={thumbnail_width:100,thumbnail_height:100,force_crop:!1});var g=gadget.get("apihost")+"/assets/new",p={authorization_token:gadget.get("token"),name:e,site:t,description:i,group:a,readers:n,tags:o,site_locked:s,type:3};return $.extend(p,d),r({type:"POST",url:g,data:$.param(p,!0),deferred:u}),u.promise()},newPlainText:function(e,t,i,a,n,o,s,d,u){void 0===n&&(n="Everyone"),void 0===o&&(o="Everyone"),void 0===d&&(d=!0);var g=gadget.get("apihost")+"/assets/new",p={authorization_token:gadget.get("token"),name:e,site:t,description:i,group:n,readers:o,content:a,tags:s,site_locked:d,type:2};return r({type:"POST",url:g,data:$.param(p,!0),deferred:u}),u.promise()},newSourceCode:function(e,t,i,a,n,o,s,d,u,g){void 0===n&&(n="Everyone"),void 0===o&&(o="Everyone"),void 0===d&&(d=!0),void 0===u&&(u={});var p=gadget.get("apihost")+"/assets/new",c={authorization_token:gadget.get("token"),name:e,site:t,description:i,group:n,readers:o,content:a,tags:s,site_locked:d,type:1};return $.extend(c,u),r({type:"POST",url:p,data:$.param(c,!0),deferred:g}),g.promise()},newWebContent:function(e,t,i,a,n,o,s,d,u){void 0===n&&(n="Everyone"),void 0===o&&(o="Everyone"),void 0===d&&(d=!0);var g=gadget.get("apihost")+"/assets/new",p={authorization_token:gadget.get("token"),name:e,site:t,description:i,group:n,readers:o,content:a,tags:s,site_locked:d,type:0};return r({type:"POST",url:g,data:$.param(p,!0),deferred:u}),u.promise()},publish:function(e,t,i,a){return r({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS/"+t,log:i},deferred:a}),a.promise()},view:function(e,t,i){return r({type:"GET",url:gadget.get("apihost")+"/assets/view",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:i}),i.promise()}},reports:{generate:function(){return m.requestsQueued=v.length,m.requestsMade=m.requestsQueued+m.requestsFinished+m.requestsPending,m}},util:{findReplaceStatus:function(e,t){var r=new $.Deferred,i=gadget.get("apihost")+"/sites/findreplacestatus",a={authorization_token:gadget.get("token"),id:t,site:e},n=setInterval(function(){$.ajax({type:"GET",url:i,data:a}).then(function(e){1==e.error&&(clearInterval(n),r.reject(e)),1==e.finished&&(clearInterval(n),r.resolve(e))},function(e){clearInterval(n),r.reject(e)})},2e3);return r.promise()},printPromiseStates:function(){var e="";$.each(c,function(t,r){e+=r.state()+", "})}},callbacks:{onComplete:function(e){$(this).on("ouapi.complete",function(t,r){e&&e(r)})},onEmpty:function(e){$(this).on("ouapi.empty",function(t){e&&e()})},onError:function(e){$(this).on("ouapi.error",function(t,r){e&&e(r)})},onSuccess:function(e){$(this).on("ouapi.success",function(t,r){e&&e(r)})}},ready:function(e){var t=new $.Deferred;return this.isReady?(k=!0,e&&e(),t.resolve()):$(this).one("ouapi.ready",function(){e&&e(),t.resolve()}),t}},_=["ready","reports","callbacks","util"],T=["callbacks"];for(var S in y)if(!$.inArray(S,T))for(var z in y[S])y[S][z]=y[S][z].bind(y);for(var z in y.callbacks)y[z]=y.callbacks[z].bind(y);for(var S in y)if(!($.inArray(S,_)>-1))for(var z in y[S]){var P=y[S][z];"function"==typeof P&&(y[S][z]=function(e,t,r){return function(){var i=Array.prototype.slice.call(arguments);if(i.length<e.length-1)for(var a=e.length-1-i.length,n=0;n<a;n++)i.push(void 0);var o=i[i.length-1];return s(o)||(o=new $.Deferred,i.push(o)),d(t,r,i)?e.apply(this,i):o.promise()}}(P,S,z))}window.ouapi=y,y.isReady=!0,$(y).trigger("ouapi.ready")}();