"use strict";!function(){function e(){console.log("--dequeue--"),console.log("queue length "+f+": ",y.length),console.log("promise queue length: ",p.length),console.log("numConnections: ",k),f>=c?(console.log("ready to wait"),0==h&&(console.log("when is not applied yet"),h=!0,$.when.apply($,p).always(function(){console.log("when fires"),setTimeout(function(){console.log("timeout fires"),a(),t(u)},d)}))):(console.log("call next"),t())}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(e=e<=y.length?e:y.length,i=0;i<e;i++){var t=y.shift();t.func.apply(v,t.args)}}function o(t){var o=t.complete||null,n=t.success||null,r=t.error||null,i={params:t.data};return t.success=function(o,s,a){m.requestsPending--,e(),o.methodData=i,o.error?(m.requestsFailed++,t.deferred.reject(o),r&&r(o,s,a),$(v).trigger("ouapi.error",o)):(m.requestsSuccessful++,t.deferred.resolve(o),n&&n(o,s,a),$(v).trigger("ouapi.success",o))},t.error=function(o,n,s){m.requestsPending--,m.requestsFailed++,e(),o.methodData=i,t.deferred.reject(o),r&&r(o,n,s),$(v).trigger("ouapi.error",o)},t.complete=function(e,t,n){s(),e.methodData=i,o&&o(e,t,n),$(v).trigger("ouapi.complete",e)},m.requestsPending++,$.ajax(t)}function n(){return k<u}function r(){k++,f++}function s(){console.log("--close connection - requestsFinished: ",m.requestsFinished),k--,m.requestsFinished++,y.length<1&&$(v).trigger("ouapi.empty")}function a(){f=0,p=[],h=!1}function l(e){return!(!e.promise||!e.notify)}function g(e,t,o){console.log("--checkQueue--");var i=o[o.length-1];return n()?(p.push(i.promise()),r(),!0):(y.push({func:v[e][t],args:o}),!1)}var u=3,d=2e3,c=5,p=[],h=!1,f=0,k=0,y=[],m={requestsQueued:0,requestsFinished:0,requestsMade:0,requestsSuccessful:0,requestsFailed:0,requestsPending:0},v={snippets:{add:function(e,t,n,r,i,s){console.log("--addSnippet--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addsnippet",data:{authorization_token:gadget.get("token"),name:e,snippet:e,path:t,site:n,description:r,category:i},deferred:s}),s.promise()},createCategory:function(e,t,n){console.log("--createSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addcategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()},removeCategory:function(e,t,n){console.log("--removeSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/removecategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()}},files:{checkedOut:function(e,t){console.log("--checkedOutFiles--");return o({type:"GET",url:gadget.get("apihost")+"/files/checkedout",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},checkin:function(e,t,n){console.log("--checkinFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/checkin",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},create:function(e,t,n,r,i){console.log("--createFile--");return o({type:"POST",url:gadget.get("apihost")+"/templates/new",data:{authorization_token:gadget.get("token"),site:n,path:t,template:"20_newfile.tcf",submit:"Create",tcf_value_0:e,tcf_value_1:r,tcf_value_2:"*inherit*"},deferred:i}),i.promise()},delete:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments[3];console.log("--deleteFile/Folder--");var i=gadget.get("apihost")+"/files/delete",s={authorization_token:gadget.get("token"),site:t,path:e,remote:n};return o({type:"POST",url:i,data:$.param(s,!0),deferred:r}),r.promise()},dependents:function(e,t,n){console.log("--fileDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},get:function(e,t,n){return console.log("--getFiles--"),o({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},new_folder:function(e,t,n,r){return console.log("--new_folder--"),o({type:"POST",url:gadget.get("apihost")+"/files/new_folder",data:{authorization_token:gadget.get("token"),name:e,site:n,path:t},deferred:r}),r.promise()},publish:function(e,t,n,r){console.log("--publishFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:t,path:e,log:n},deferred:r}),r.promise()},publishMulti:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=arguments[9];console.log("--publishMultiFile--");var d=gadget.get("apihost")+"/files/multipublish",c={authorization_token:gadget.get("token"),site:t,path:e,log:n,type:0,include_checked_out:r,include_scheduled_publish:i,include_pending_approval:s,changed_only:a,last_published:l,include_unpublished:g};return o({type:"POST",url:d,data:$.param(c,!0),deferred:u}),u.promise()},recycle:function(e,t,n){console.log("--recycleFiles--");var r=gadget.get("apihost")+"/files/recycle",i={authorization_token:gadget.get("token"),site:t,path:e};return o({type:"POST",url:r,data:$.param(i,!0),deferred:n}),n.promise()}},sites:{list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,t=arguments[1],n=arguments[2],r=arguments[3];console.log("--sitesList--"),void 0===t&&(t=gadget.get("site")),void 0===n&&(n=gadget.get("account"));return o({type:"GET",url:gadget.get("apihost")+"/sites/list",data:{authorization_token:gadget.get("token"),count:e,account:n,site:t},deferred:r}),r.promise()}},assets:{checkin:function(e,t,n){return console.log("--checkinAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkin",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},checkout:function(e,t,n){return console.log("--checkoutAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkout",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},delete:function(e,t,n){console.log("--deleteAsset--");var r=gadget.get("apihost")+"/assets/delete",i={authorization_token:gadget.get("token"),site:e,asset:t};return o({type:"POST",url:r,data:$.param(i,!0),deferred:n}),n.promise()},dependents:function(e,t,n){console.log("--assetDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:"/OMNI-ASSETS/"+e+".html"},deferred:n}),n.promise()},list:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"asc",s=arguments[5];console.log("--listAssets--");return o({type:"GET",url:gadget.get("apihost")+"/assets/list",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS",count:t,start:n,sort_key:r,sort_order:sort_order,sortOrder:i,ignore_readers:!0},deferred:s}),s.promise()},new:function(){},publish:function(e,t,n,r){console.log("--publishAsset--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:t,path:"/OMNI-ASSETS/"+e,log:n},deferred:r}),r.promise()}},reports:{generate:function(){return m.requestsQueued=y.length,m.requestsMade=m.requestsQueued+m.requestsFinished+m.requestsPending,m}},callbacks:{onComplete:function(e){console.log("\n **** ON COMPLETE CALLS **** \n"),$(this).on("ouapi.complete",function(t,o){e&&e(o)})},onEmpty:function(e){console.log("\n **** ON EMPTY CALLS **** \n"),$(this).on("ouapi.empty",function(t){e&&e()})},onError:function(e){console.log("\n **** ON ERROR CALLS **** \n"),$(this).on("ouapi.error",function(t,o){e&&e(o)})},onSuccess:function(e){console.log("\n **** ON SUCCESS CALLS **** \n"),$(this).on("ouapi.success",function(t,o){e&&e(o)})}},ready:function(e){console.log("ready() start");var t=new $.Deferred;return this.isReady?(console.log("ready - true"),isReady=!0,e&&e(),t.resolve()):(console.log("ready - false"),$(this).one("ouapi.ready",function(){console.log("ready callback"),e&&e(),t.resolve()})),t}};console.log("api: ",v);var _=["ready","reports","callbacks"],S=["callbacks"];for(var O in v)if(!$.inArray(O,S))for(var T in v[O])v[O][T]=v[O][T].bind(v);for(var T in v.callbacks)v[T]=v.callbacks[T].bind(v);for(var O in v)if(!($.inArray(O,_)>-1))for(var T in v[O]){var q=v[O][T];"function"==typeof q&&(v[O][T]=function(e,t,o){return function(){var n=Array.prototype.slice.call(arguments),r=n[n.length-1];return l(r)||(r=new $.Deferred,n.push(r)),g(t,o,n)?e.apply(this,n):r.promise()}}(q,O,T))}window.ouapi=v,v.isReady=!0,$(v).trigger("ouapi.ready")}();