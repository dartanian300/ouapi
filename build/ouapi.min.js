"use strict";!function(){function e(){console.log("--dequeue--"),console.log("queue length "+f+": ",m.length),console.log("promise queue length: ",c.length),console.log("numConnections: ",h),f>=u?(console.log("ready to wait"),0==p&&(console.log("when is not applied yet"),p=!0,$.when.apply($,c).always(function(){console.log("when fires"),setTimeout(function(){console.log("timeout fires"),a(),t(d)},l)}))):(console.log("call next"),t())}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e=e<=m.length?e:m.length;for(var t=0;t<e;t++){var o=m.shift();o.func.apply(y,o.args)}}function o(t){var o=t.complete||null,n=t.success||null,i=t.error||null,a={params:t.data};return t.success=function(o,s,g){r(),v.requestsPending--,e(),o.methodData=a,o.error?(v.requestsFailed++,t.deferred.reject(o),i&&i(o,s,g),$(y).trigger("ouapi.error",o)):(v.requestsSuccessful++,t.deferred.resolve(o),n&&n(o,s,g),$(y).trigger("ouapi.success",o))},t.error=function(o,n,s){r(),v.requestsPending--,v.requestsFailed++,e(),o.methodData=a,t.deferred.reject(o),i&&i(o,n,s),$(y).trigger("ouapi.error",o)},t.complete=function(e,t,n){e.methodData=a,o&&o(e,t,n),$(y).trigger("ouapi.complete",e)},v.requestsPending++,$.ajax(t)}function n(){return h<d}function i(){h++,f++}function r(){console.log("--close connection - requestsFinished: ",v.requestsFinished),h--,v.requestsFinished++,m.length<1&&$(y).trigger("ouapi.empty")}function a(){f=0,c=[],p=!1}function s(e){return void 0!==e&&!(!e.promise||!e.notify)}function g(e,t,o){console.log("--checkQueue--");var r=o[o.length-1];return n()?(c.push(r.promise()),i(),!0):(m.push({func:y[e][t],args:o}),!1)}var d=3,l=2e3,u=5,c=[],p=!1,f=0,h=0,m=[],v={requestsQueued:0,requestsFinished:0,requestsMade:0,requestsSuccessful:0,requestsFailed:0,requestsPending:0},k=!1,y={snippets:{add:function(e,t,n,i,r,a){console.log("--addSnippet--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addsnippet",data:{authorization_token:gadget.get("token"),name:e,snippet:e,path:t,site:n,description:i,category:r},deferred:a}),a.promise()},createCategory:function(e,t,n){console.log("--createSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addcategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()},list:function(e,t){console.log("--listSnippets/Categories--");return o({type:"GET",url:gadget.get("apihost")+"/snippets/list",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},remove:function(e,t,n,i){console.log("--removeSnippet--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/removesnippet",data:{authorization_token:gadget.get("token"),snippet:e,site:t,category:n},deferred:i}),i.promise()},removeCategory:function(e,t,n){console.log("--removeSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/removecategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()}},files:{checkedOut:function(e,t){console.log("--checkedOutFiles--");return o({type:"GET",url:gadget.get("apihost")+"/files/checkedout",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},checkin:function(e,t,n){console.log("--checkinFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/checkin",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},checkout:function(e,t,n){console.log("--checkoutFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/checkout",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},create:function(e,t,n,i,r){console.log("--createFile--"),void 0===i&&(i=!1);return o({type:"POST",url:gadget.get("apihost")+"/templates/new",data:{authorization_token:gadget.get("token"),site:n,path:t,template:"20_newfile.tcf",submit:"Create",tcf_value_0:e,tcf_value_1:i,tcf_value_2:"*inherit*"},deferred:r}),r.promise()},delete:function(e,t,n,i){console.log("--deleteFile/Folder--"),void 0===n&&(n=!1);var r=gadget.get("apihost")+"/files/delete",a={authorization_token:gadget.get("token"),site:t,path:e,remote:n};return o({type:"POST",url:r,data:$.param(a,!0),deferred:i}),i.promise()},dependents:function(e,t,n){console.log("--fileDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},get:function(e,t,n){return console.log("--getFiles--"),o({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},info:function(e,t,n){console.log("--fileInfo--");return o({type:"GET",url:gadget.get("apihost")+"/files/info",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},list:function(e,t,n){console.log("--listFiles--");return o({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},new_folder:function(e,t,n,i){return console.log("--new_folder--"),o({type:"POST",url:gadget.get("apihost")+"/files/new_folder",data:{authorization_token:gadget.get("token"),name:e,site:n,path:t},deferred:i}),i.promise()},publish:function(e,t,n,i){console.log("--publishFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:t,path:e,log:n},deferred:i}),i.promise()},publishMulti:function(e,t,n,i,r,a,s,g,d,l){console.log("--publishMultiFile--"),void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===g&&(g=!1),void 0===d&&(d=!0);var u=gadget.get("apihost")+"/files/multipublish",c={authorization_token:gadget.get("token"),site:t,path:e,log:n,type:0,include_checked_out:i,include_scheduled_publish:r,include_pending_approval:a,changed_only:s,last_published:g,include_unpublished:d};return o({type:"POST",url:u,data:$.param(c,!0),deferred:l}),l.promise()},recycle:function(e,t,n){console.log("--recycleFiles--");var i=gadget.get("apihost")+"/files/recycle",r={authorization_token:gadget.get("token"),site:t,path:e};return o({type:"POST",url:i,data:$.param(r,!0),deferred:n}),n.promise()},save:function(e,t,n,i){console.log("--saveFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/save",data:{authorization_token:gadget.get("token"),site:t,path:e,text:n},deferred:i}),i.promise()},source:function(e,t,n,i){console.log("--removeSnippet--"),void 0===n&&(n=!0);return o({type:"GET",url:gadget.get("apihost")+"/files/source",data:{authorization_token:gadget.get("token"),site:e,path:t,brokentags:n},deferred:i}),i.promise()}},directories:{settings:function(e,t,n){console.log("--directorySettings--");return o({type:"GET",url:gadget.get("apihost")+"/directories/settings",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()}},sites:{find:function(e,t,n,i,a,s,g,d,l){console.log("--siteFind--"),void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===s&&(s="string"),void 0===g&&(g=!0),void 0===d&&(d=[]);var u=gadget.get("apihost")+"/sites/findreplace",c={authorization_token:gadget.get("token"),site:e,srchstr:t,casesensitive:n,includelocked:i,paths:JSON.stringify(a),srchtype:s,negexts:g,extensions:d},p=new $.Deferred;return void 0===a?(r(),y.files.list("/",e).then(function(t){var n=$.map(t.entries,function(e){return e.staging_path});c.paths=JSON.stringify(n),o({type:"POST",url:u,data:$.param(c,!0),deferred:p}).then(function(t){return y.util.findReplaceStatus(e,t.id)}).then(function(e){l.resolve(e)}).fail(function(e){l.reject(e)})})):o({type:"POST",url:u,data:$.param(c,!0),deferred:p}).then(function(t){return y.util.findReplaceStatus(e,t.id)}).then(function(e){l.resolve(e)}).fail(function(e){l.reject(e)}),l.promise()},list:function(e,t,n,i){void 0===n&&(n=5e3),console.log("--sitesList--"),console.log("arguments: ",arguments),void 0===e&&(e=gadget.get("site")),void 0===t&&(t=gadget.get("account"));return o({type:"GET",url:gadget.get("apihost")+"/sites/list",data:{authorization_token:gadget.get("token"),count:n,account:t,site:e},deferred:i}),i.promise()},test:function(e,t){return console.log("--test--"),y.sites.list(e).done(function(n){console.log("sites: ",n);o({type:"GET",url:gadget.get("apihost")+"/snippets/list",data:{authorization_token:gadget.get("token"),site:e},deferred:t})}),t.promise()}},assets:{add_image:function(e,t,n,i,r,a){console.log("--assetAddImage--"),void 0===i&&(i=100),void 0===r&&(r=100);var s=new FormData,g=new File([fileContents],filename,{type:"image/jpeg"});return s.append(filename,g),o({type:"POST",url:gadget.get("apihost")+"/assets/add_image",data:{authorization_token:gadget.get("token"),site:e,asset:t,image:n,thumb_width:i,thumb_height:r},deferred:a}),a.promise()},checkin:function(e,t,n){return console.log("--checkinAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkin",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},checkout:function(e,t,n){return console.log("--checkoutAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkout",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},delete:function(e,t,n){console.log("--deleteAsset--");var i=gadget.get("apihost")+"/assets/delete",r={authorization_token:gadget.get("token"),site:e,asset:t};return o({type:"POST",url:i,data:$.param(r,!0),deferred:n}),n.promise()},dependents:function(e,t,n){console.log("--assetDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:"/OMNI-ASSETS/"+e+".html"},deferred:n}),n.promise()},info:function(e,t,n){return console.log("--assetInfo--"),o({type:"GET",url:gadget.get("apihost")+"/assets/info",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},list:function(e,t,n,i,r,a){console.log("--listAssets--"),void 0===t&&(t=100),void 0===n&&(n=1),void 0===i&&(i="name"),void 0===r&&(r="asc");return o({type:"GET",url:gadget.get("apihost")+"/assets/list",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS",count:t,start:n,sort_key:i,sort_order:r,ignore_readers:!0},deferred:a}),a.promise()},new:function(){},newForm:function(e,t,n,i,r,a,s,g,d,l,u){console.log("--newFormAsset--"),void 0!==i&&""!=i||(i="[]"),void 0!==r&&""!=r||(r="[]"),void 0===a&&(a="Everyone"),void 0===s&&(s="Everyone"),void 0===d&&(d=!0),void 0===l&&(l={pass_message:"Thank you for your submission",fail_message:"There was an error. Please try again.",use_database:!0,captcha:!1});var c=gadget.get("apihost")+"/assets/new",p={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:a,readers:s,elements:i,emails:r,tags:g,site_locked:d,type:4};return $.extend(p,l),o({type:"POST",url:c,data:$.param(p,!0),deferred:u}),u.promise()},newImageGallery:function(e,t,n,i,r,a,s,g,d){console.log("--newImageGalleryAsset--"),void 0===i&&(i="Everyone"),void 0===r&&(r="Everyone"),void 0===s&&(s=!0),void 0===g&&(g={thumbnail_width:100,thumbnail_height:100,force_crop:!1});var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:i,readers:r,tags:a,site_locked:s,type:3};return $.extend(u,g),o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},newPlainText:function(e,t,n,i,r,a,s,g,d){console.log("--newPlainTextAsset--"),void 0===r&&(r="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0);var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:r,readers:a,content:i,tags:s,site_locked:g,type:2};return o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},newSourceCode:function(e,t,n,i,r,a,s,g,d,l){console.log("--newSourceCodeAsset--"),void 0===r&&(r="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0),void 0===d&&(d={});var u=gadget.get("apihost")+"/assets/new",c={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:r,readers:a,content:i,tags:s,site_locked:g,type:1};return $.extend(c,d),o({type:"POST",url:u,data:$.param(c,!0),deferred:l}),l.promise()},newWebContent:function(e,t,n,i,r,a,s,g,d){console.log("--newWebContentAsset--"),void 0===r&&(r="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0);var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:r,readers:a,content:i,tags:s,site_locked:g,type:0};return o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},publish:function(e,t,n,i){console.log("--publishAsset--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS/"+t,log:n},deferred:i}),i.promise()},view:function(e,t,n){return console.log("--viewAsset--"),o({type:"GET",url:gadget.get("apihost")+"/assets/view",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()}},reports:{generate:function(){return v.requestsQueued=m.length,v.requestsMade=v.requestsQueued+v.requestsFinished+v.requestsPending,v}},util:{findReplaceStatus:function(e,t){console.log("--findReplaceStatus--");var o=new $.Deferred,n=gadget.get("apihost")+"/sites/findreplacestatus",i={authorization_token:gadget.get("token"),id:t,site:e},r=setInterval(function(){$.ajax({type:"GET",url:n,data:i}).then(function(e){1==e.error&&(clearInterval(r),o.reject(e)),1==e.finished&&(clearInterval(r),o.resolve(e))},function(e){clearInterval(r),o.reject(e)})},2e3);return o.promise()},printPromiseStates:function(){var e="";$.each(c,function(t,o){e+=o.state()+", "}),console.log("ouapi promise states: "+e)}},callbacks:{onComplete:function(e){console.log("\n **** ON COMPLETE CALLS **** \n"),$(this).on("ouapi.complete",function(t,o){e&&e(o)})},onEmpty:function(e){console.log("\n **** ON EMPTY CALLS **** \n"),$(this).on("ouapi.empty",function(t){e&&e()})},onError:function(e){console.log("\n **** ON ERROR CALLS **** \n"),$(this).on("ouapi.error",function(t,o){e&&e(o)})},onSuccess:function(e){console.log("\n **** ON SUCCESS CALLS **** \n"),$(this).on("ouapi.success",function(t,o){e&&e(o)})}},ready:function(e){console.log("ready() start");var t=new $.Deferred;return this.isReady?(console.log("ready - true"),k=!0,e&&e(),t.resolve()):(console.log("ready - false"),$(this).one("ouapi.ready",function(){console.log("ready callback"),e&&e(),t.resolve()})),t}};console.log("api: ",y);var _=["ready","reports","callbacks","util"],S=["callbacks"];for(var T in y)if(!$.inArray(T,S))for(var w in y[T])y[T][w]=y[T][w].bind(y);for(var w in y.callbacks)y[w]=y.callbacks[w].bind(y);for(var T in y)if(!($.inArray(T,_)>-1))for(var w in y[T]){var z=y[T][w];"function"==typeof z&&(y[T][w]=function(e,t,o){return function(){console.log("original method # params: ",e.length);var n=Array.prototype.slice.call(arguments);if(n.length<e.length-1)for(var i=e.length-1-n.length,r=0;r<i;r++)n.push(void 0);console.log("args (arguments): ",n);var a=n[n.length-1];return s(a)||(a=new $.Deferred,n.push(a)),g(t,o,n)?e.apply(this,n):a.promise()}}(z,T,w))}window.ouapi=y,y.isReady=!0,$(y).trigger("ouapi.ready")}();