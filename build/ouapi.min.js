"use strict";!function(){function e(){console.log("--dequeue--"),console.log("queue length "+h+": ",m.length),console.log("promise queue length: ",c.length),console.log("numConnections: ",f),h>=u?(console.log("ready to wait"),0==p&&(console.log("when is not applied yet"),p=!0,$.when.apply($,c).always(function(){console.log("when fires"),setTimeout(function(){console.log("timeout fires"),a(),t(d)},l)}))):(console.log("call next"),t())}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e=e<=m.length?e:m.length;for(var t=0;t<e;t++){var o=m.shift();o.func.apply(v,o.args)}}function o(t){var o=t.complete||null,n=t.success||null,r=t.error||null,a={params:t.data};return t.success=function(o,i,s){k.requestsPending--,e(),o.methodData=a,o.error?(k.requestsFailed++,t.deferred.reject(o),r&&r(o,i,s),$(v).trigger("ouapi.error",o)):(k.requestsSuccessful++,t.deferred.resolve(o),n&&n(o,i,s),$(v).trigger("ouapi.success",o))},t.error=function(o,n,i){k.requestsPending--,k.requestsFailed++,e(),o.methodData=a,t.deferred.reject(o),r&&r(o,n,i),$(v).trigger("ouapi.error",o)},t.complete=function(e,t,n){i(),e.methodData=a,o&&o(e,t,n),$(v).trigger("ouapi.complete",e)},k.requestsPending++,$.ajax(t)}function n(){return f<d}function r(){f++,h++}function i(){console.log("--close connection - requestsFinished: ",k.requestsFinished),f--,k.requestsFinished++,m.length<1&&$(v).trigger("ouapi.empty")}function a(){h=0,c=[],p=!1}function s(e){return void 0!==e&&!(!e.promise||!e.notify)}function g(e,t,o){console.log("--checkQueue--");var i=o[o.length-1];return n()?(c.push(i.promise()),r(),!0):(m.push({func:v[e][t],args:o}),!1)}var d=3,l=2e3,u=5,c=[],p=!1,h=0,f=0,m=[],k={requestsQueued:0,requestsFinished:0,requestsMade:0,requestsSuccessful:0,requestsFailed:0,requestsPending:0},y=!1,v={snippets:{add:function(e,t,n,r,i,a){console.log("--addSnippet--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addsnippet",data:{authorization_token:gadget.get("token"),name:e,snippet:e,path:t,site:n,description:r,category:i},deferred:a}),a.promise()},createCategory:function(e,t,n){console.log("--createSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/addcategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()},list:function(e,t){console.log("--listSnippets/Categories--");return o({type:"GET",url:gadget.get("apihost")+"/snippets/list",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},remove:function(e,t,n,r){console.log("--removeSnippet--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/removesnippet",data:{authorization_token:gadget.get("token"),snippet:e,site:t,category:n},deferred:r}),r.promise()},removeCategory:function(e,t,n){console.log("--removeSnippetCategory--");return o({type:"POST",url:gadget.get("apihost")+"/snippets/removecategory",data:{authorization_token:gadget.get("token"),site:t,category:e},deferred:n}),n.promise()}},files:{checkedOut:function(e,t){console.log("--checkedOutFiles--");return o({type:"GET",url:gadget.get("apihost")+"/files/checkedout",data:{authorization_token:gadget.get("token"),site:e},deferred:t}),t.promise()},checkin:function(e,t,n){console.log("--checkinFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/checkin",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},checkout:function(e,t,n){console.log("--checkoutFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/checkout",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},create:function(e,t,n,r,i){console.log("--createFile--"),void 0===r&&(r=!1);return o({type:"POST",url:gadget.get("apihost")+"/templates/new",data:{authorization_token:gadget.get("token"),site:n,path:t,template:"20_newfile.tcf",submit:"Create",tcf_value_0:e,tcf_value_1:r,tcf_value_2:"*inherit*"},deferred:i}),i.promise()},delete:function(e,t,n,r){console.log("--deleteFile/Folder--"),void 0===n&&(n=!1);var i=gadget.get("apihost")+"/files/delete",a={authorization_token:gadget.get("token"),site:t,path:e,remote:n};return o({type:"POST",url:i,data:$.param(a,!0),deferred:r}),r.promise()},dependents:function(e,t,n){console.log("--fileDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},get:function(e,t,n){return console.log("--getFiles--"),o({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},info:function(e,t,n){console.log("--fileInfo--");return o({type:"GET",url:gadget.get("apihost")+"/files/info",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},list:function(e,t,n){console.log("--listFiles--");return o({type:"GET",url:gadget.get("apihost")+"/files/list",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()},new_folder:function(e,t,n,r){return console.log("--new_folder--"),o({type:"POST",url:gadget.get("apihost")+"/files/new_folder",data:{authorization_token:gadget.get("token"),name:e,site:n,path:t},deferred:r}),r.promise()},publish:function(e,t,n,r){console.log("--publishFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:t,path:e,log:n},deferred:r}),r.promise()},publishMulti:function(e,t,n,r,i,a,s,g,d,l){console.log("--publishMultiFile--"),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===g&&(g=!1),void 0===d&&(d=!0);var u=gadget.get("apihost")+"/files/multipublish",c={authorization_token:gadget.get("token"),site:t,path:e,log:n,type:0,include_checked_out:r,include_scheduled_publish:i,include_pending_approval:a,changed_only:s,last_published:g,include_unpublished:d};return o({type:"POST",url:u,data:$.param(c,!0),deferred:l}),l.promise()},recycle:function(e,t,n){console.log("--recycleFiles--");var r=gadget.get("apihost")+"/files/recycle",i={authorization_token:gadget.get("token"),site:t,path:e};return o({type:"POST",url:r,data:$.param(i,!0),deferred:n}),n.promise()},save:function(e,t,n,r){console.log("--saveFile--");return o({type:"POST",url:gadget.get("apihost")+"/files/save",data:{authorization_token:gadget.get("token"),site:t,path:e,text:n},deferred:r}),r.promise()},source:function(e,t,n,r){console.log("--removeSnippet--"),void 0===n&&(n=!0);return o({type:"GET",url:gadget.get("apihost")+"/files/source",data:{authorization_token:gadget.get("token"),site:e,path:t,brokentags:n},deferred:r}),r.promise()}},directories:{settings:function(e,t,n){console.log("--directorySettings--");return o({type:"GET",url:gadget.get("apihost")+"/directories/settings",data:{authorization_token:gadget.get("token"),site:t,path:e},deferred:n}),n.promise()}},sites:{list:function(e,t,n,r){void 0===n&&(n=5e3),console.log("--sitesList--"),console.log("arguments: ",arguments),void 0===e&&(e=gadget.get("site")),void 0===t&&(t=gadget.get("account"));return o({type:"GET",url:gadget.get("apihost")+"/sites/list",data:{authorization_token:gadget.get("token"),count:n,account:t,site:e},deferred:r}),r.promise()}},assets:{add_image:function(e,t,n,r,i,a){console.log("--assetAddImage--"),void 0===r&&(r=100),void 0===i&&(i=100);var s=new FormData,g=new File([fileContents],filename,{type:"image/jpeg"});return s.append(filename,g),o({type:"POST",url:gadget.get("apihost")+"/assets/add_image",data:{authorization_token:gadget.get("token"),site:e,asset:t,image:n,thumb_width:r,thumb_height:i},deferred:a}),a.promise()},checkin:function(e,t,n){return console.log("--checkinAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkin",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},checkout:function(e,t,n){return console.log("--checkoutAsset--"),o({type:"POST",url:gadget.get("apihost")+"/assets/checkout",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},delete:function(e,t,n){console.log("--deleteAsset--");var r=gadget.get("apihost")+"/assets/delete",i={authorization_token:gadget.get("token"),site:e,asset:t};return o({type:"POST",url:r,data:$.param(i,!0),deferred:n}),n.promise()},dependents:function(e,t,n){console.log("--assetDependents--");return o({type:"GET",url:gadget.get("apihost")+"/files/dependents",data:{authorization_token:gadget.get("token"),site:t,path:"/OMNI-ASSETS/"+e+".html"},deferred:n}),n.promise()},info:function(e,t,n){return console.log("--assetInfo--"),o({type:"GET",url:gadget.get("apihost")+"/assets/info",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()},list:function(e,t,n,r,i,a){console.log("--listAssets--"),void 0===t&&(t=100),void 0===n&&(n=1),void 0===r&&(r="name"),void 0===i&&(i="asc");return o({type:"GET",url:gadget.get("apihost")+"/assets/list",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS",count:t,start:n,sort_key:r,sort_order:i,ignore_readers:!0},deferred:a}),a.promise()},new:function(){},newForm:function(e,t,n,r,i,a,s,g,d,l,u){console.log("--newFormAsset--"),void 0!==r&&""!=r||(r="[]"),void 0!==i&&""!=i||(i="[]"),void 0===a&&(a="Everyone"),void 0===s&&(s="Everyone"),void 0===d&&(d=!0),void 0===l&&(l={pass_message:"Thank you for your submission",fail_message:"There was an error. Please try again.",use_database:!0,captcha:!1});var c=gadget.get("apihost")+"/assets/new",p={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:a,readers:s,elements:r,emails:i,tags:g,site_locked:d,type:4};return $.extend(p,l),o({type:"POST",url:c,data:$.param(p,!0),deferred:u}),u.promise()},newImageGallery:function(e,t,n,r,i,a,s,g,d){console.log("--newImageGalleryAsset--"),void 0===r&&(r="Everyone"),void 0===i&&(i="Everyone"),void 0===s&&(s=!0),void 0===g&&(g={thumbnail_width:100,thumbnail_height:100,force_crop:!1});var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:r,readers:i,tags:a,site_locked:s,type:3};return $.extend(u,g),o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},newPlainText:function(e,t,n,r,i,a,s,g,d){console.log("--newPlainTextAsset--"),void 0===i&&(i="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0);var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:i,readers:a,content:r,tags:s,site_locked:g,type:2};return o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},newSourceCode:function(e,t,n,r,i,a,s,g,d,l){console.log("--newSourceCodeAsset--"),void 0===i&&(i="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0),void 0===d&&(d={});var u=gadget.get("apihost")+"/assets/new",c={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:i,readers:a,content:r,tags:s,site_locked:g,type:1};return $.extend(c,d),o({type:"POST",url:u,data:$.param(c,!0),deferred:l}),l.promise()},newWebContent:function(e,t,n,r,i,a,s,g,d){console.log("--newWebContentAsset--"),void 0===i&&(i="Everyone"),void 0===a&&(a="Everyone"),void 0===g&&(g=!0);var l=gadget.get("apihost")+"/assets/new",u={authorization_token:gadget.get("token"),name:e,site:t,description:n,group:i,readers:a,content:r,tags:s,site_locked:g,type:0};return o({type:"POST",url:l,data:$.param(u,!0),deferred:d}),d.promise()},publish:function(e,t,n,r){console.log("--publishAsset--");return o({type:"POST",url:gadget.get("apihost")+"/files/publish",data:{authorization_token:gadget.get("token"),site:e,path:"/OMNI-ASSETS/"+t,log:n},deferred:r}),r.promise()},view:function(e,t,n){return console.log("--viewAsset--"),o({type:"GET",url:gadget.get("apihost")+"/assets/view",data:{authorization_token:gadget.get("token"),site:e,asset:t},deferred:n}),n.promise()}},reports:{generate:function(){return k.requestsQueued=m.length,k.requestsMade=k.requestsQueued+k.requestsFinished+k.requestsPending,k}},callbacks:{onComplete:function(e){console.log("\n **** ON COMPLETE CALLS **** \n"),$(this).on("ouapi.complete",function(t,o){e&&e(o)})},onEmpty:function(e){console.log("\n **** ON EMPTY CALLS **** \n"),$(this).on("ouapi.empty",function(t){e&&e()})},onError:function(e){console.log("\n **** ON ERROR CALLS **** \n"),$(this).on("ouapi.error",function(t,o){e&&e(o)})},onSuccess:function(e){console.log("\n **** ON SUCCESS CALLS **** \n"),$(this).on("ouapi.success",function(t,o){e&&e(o)})}},ready:function(e){console.log("ready() start");var t=new $.Deferred;return this.isReady?(console.log("ready - true"),y=!0,e&&e(),t.resolve()):(console.log("ready - false"),$(this).one("ouapi.ready",function(){console.log("ready callback"),e&&e(),t.resolve()})),t}};console.log("api: ",v);var _=["ready","reports","callbacks"],S=["callbacks"];for(var T in v)if(!$.inArray(T,S))for(var w in v[T])v[T][w]=v[T][w].bind(v);for(var w in v.callbacks)v[w]=v.callbacks[w].bind(v);for(var T in v)if(!($.inArray(T,_)>-1))for(var w in v[T]){var z=v[T][w];"function"==typeof z&&(v[T][w]=function(e,t,o){return function(){console.log("original method # params: ",e.length);var n=Array.prototype.slice.call(arguments);if(n.length<e.length-1)for(var r=e.length-1-n.length,i=0;i<r;i++)n.push(void 0);console.log("args (arguments): ",n);var a=n[n.length-1];return s(a)||(a=new $.Deferred,n.push(a)),g(t,o,n)?e.apply(this,n):a.promise()}}(z,T,w))}window.ouapi=v,v.isReady=!0,$(v).trigger("ouapi.ready")}();